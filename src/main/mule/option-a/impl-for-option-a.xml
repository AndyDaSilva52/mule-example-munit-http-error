<?xml version="1.0" encoding="UTF-8"?>

<mule
  xmlns:http="http://www.mulesoft.org/schema/mule/http"
  xmlns="http://www.mulesoft.org/schema/mule/core"
  xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="
    http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
    http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
    http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">

  <sub-flow name="impl-for-option-a">
    <logger
      level="INFO"
      doc:name="INFO BEFORE"
      message="#[output application/json --- { tracepoint: 'BEFORE', message   : message }]" />
    <try doc:name="Try">
      <http:request
        method="GET"
        doc:name="HTTP Req External"
        sendBodyMode="ALWAYS"
        url="http://example.com/external" />
      <error-handler>
        <on-error-continue
          enableNotifications="true"
          logException="true"
          doc:name="On Error Continue"
          when="#[ ( error.errorMessage.attributes.statusCode == 400 ) and ( error.errorMessage.payload.message contains 'Account already exists!' ) ]">
          <logger
            level="ERROR"
            message="#[output application/json --- { tracepoint: 'EXCEPTION', }]"
            doc:name="ERROR EXCEPTION Req External" />
        </on-error-continue>
      </error-handler>
    </try>
    <try doc:name="Try">
      <http:request
        method="GET"
        doc:name="HTTP Req System validResponseCode=200..204"
        sendBodyMode="ALWAYS"
        url="http://example.com/system">
        <http:response-validator>
          <http:success-status-code-validator
            values="200..204" />
        </http:response-validator>
      </http:request>
      <error-handler>
        <on-error-continue
          enableNotifications="true"
          logException="true"
          doc:name="On Error Continue"
          when="#[ (error.errorMessage.attributes.statusCode == 503) ]">
          <logger
            doc:name="ERROR EXCEPTION Req System"
            message="#[output application/json --- { tracepoint: 'EXCEPTION', }]"
            level="INFO" />
        </on-error-continue>
      </error-handler>
    </try>
    <http:request
      method="GET"
      doc:name="HTTP Req Process GET"
      sendBodyMode="ALWAYS"
      url="http://example.com/process">
    </http:request>
    <logger
      level="INFO"
      doc:name="INFO AFTER"
      doc:id="d5d8b5e7-342b-462f-915b-a4bdf67e94d8"
      message="#[output application/json --- { tracepoint: 'AFTER', message   : message }]" />
  </sub-flow>


</mule>