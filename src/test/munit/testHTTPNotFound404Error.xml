<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:munit="http://www.mulesoft.org/schema/mule/munit"
	xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xsi:schemaLocation="
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
		http://www.mulesoft.org/schema/mule/munit-tools  http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">
	<munit:config name="testHTTPNotFoundError.xml" />
	<http:request-config name="HTTP_Request_configuration" doc:name="HTTP Request configuration" doc:id="08b9b57c-0b48-47c5-b79c-e757d2764a55" >
		<http:request-connection host="localhost" port="8081" />
	</http:request-config>
	<munit:test name="testHTTPNotFound404Error-MuleError" doc:id="8c2b7425-402c-4ee4-9903-bd3878b14d0e" description="Test" expectedErrorType="HTTP:NOT_FOUND">
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="HTTPEndpoint" />
		</munit:enable-flow-sources>
		<munit:execution>
			<http:request method="GET" doc:name="Request" doc:id="c24257a2-2ec2-45f9-a7a0-152ca8129985" config-ref="HTTP_Request_configuration" path="/NotExist"/>
		</munit:execution>
	</munit:test>
	<munit:test name="testHTTPNotFound404Error-HTTPStatusCode" doc:id="03ac87f6-b72d-44f2-9a59-2a7dc64b5d81">
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="HTTPEndpoint" />
		</munit:enable-flow-sources>
		<munit:execution >
			<http:request method="GET" doc:name="Request" doc:id="73b43fde-1001-4b1c-b8a0-c007ea979099" config-ref="HTTP_Request_configuration" path="/NotExist">
				<http:response-validator >
					<http:success-status-code-validator values="404" />
				</http:response-validator>
			</http:request>
		</munit:execution>
		<munit:validation >
			<munit-tools:assert-equals doc:name="Assert equals" doc:id="b6662157-0951-4b80-a8e8-00a14991bc20" actual="#[attributes.statusCode]" expected="#[404]" message="Target HTTP Endpoint doesn't return 404 status code as expected"/>
		</munit:validation>
	</munit:test>
	<munit:test name="testHTTPNotFound404ErrorTest-HTTPMessageBody" doc:id="15f0493f-61b7-41b5-9c23-9d4f51573f43" >
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="HTTPEndpoint" />
		</munit:enable-flow-sources>
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock when" doc:id="1a456372-e7a0-4ff9-a613-2b7d91b586b5" processor="http:request">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="GET" attributeName="method" />
					<munit-tools:with-attribute whereValue="Request" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="HTTP_Request_configuration1" attributeName="config-ref" />
					<munit-tools:with-attribute whereValue="/NotExist" attributeName="path" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:error typeId="HTTP:NOT_FOUND" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<http:request method="GET" doc:name="Request" doc:id="c0c10668-5aaa-4a10-a491-6cd2406fe660" config-ref="HTTP_Request_configuration" path="/">
				<http:response-validator >
					<http:success-status-code-validator values="404" />
				</http:response-validator>
			</http:request>
		</munit:execution>
		<munit:validation >
			<munit-tools:assert-equals doc:name="Assert equals" doc:id="9c538e3c-e651-47bf-8e75-51cd358016a8" actual="#[payload]" expected='#["Upstream service resource not available"]'/>
		</munit:validation>
	</munit:test>

</mule>
